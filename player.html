<!doctype html >
<html lang="es" xml:lang="es">
	<head>
		<title>Portfolio: Zona de Juegos.</title>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />		
		<link href='https://fonts.googleapis.com/css?family=Kreon' rel='stylesheet' type='text/css'>
		<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
		<script type="text/javascript" src="js/swfobject.js"></script>
		<link href="css/playerStyle.css" type="text/css" rel="stylesheet" />
	</head>
	<script>
		function IsJsonString(str) {
		    try {
		        JSON.parse(str);
		    } catch (e) {
		        return false;
		    }
		    return true;
		}
		
		$(document).ready(function(){
			// Tomamos la URL de la pagina, que tiene el JSON adjunto
			var href =  window.location.href;

			// Decodificamos la URL (para que no esten los %22 en los espacios en blanco)
			var strJson = decodeURIComponent(href);

			// Parseamos la url para obtener el JSON propiamente dicho
			var json = strJson.substring("?game=");
			var ini = json.indexOf("=");
			var res = "{" + json.substring(ini+1, json.length) + "}";
			if (IsJsonString(res)){
				res = jQuery.parseJSON(res);				
			}

			// Con el JSON vamos asignando los datos del juego		
			var w = res.width;
			var h = res.height;

			// Si el tipo de juego es SWF
			// SWF
			var flashvars={};
			var params={};
			var attributes={};

			if (res.tipo== "swf"){
				swfobject.embedSWF(res.data, "myContent",w, h, "9.0.0", "expressInstall.swf",flashvars,params,attributes,onFlashReady);	
				function onFlashReady(e) {
					var f = swfobject.getObjectById('myContent');
					f.tabIndex = 0;
					f.focus();
				}
			}else 
			if (res.tipo=="iframe"){
				var  ifrm = document.createElement("IFRAME"); 
   				ifrm.setAttribute("src", res.data); 
   				ifrm.style.width = w+"px"; 
   				ifrm.style.height = h+"px"; 
   				document.getElementById('myContent').appendChild(ifrm);
			}

			// SWF
			// Falta: iframe para los juegos HTML5
		    $('#container').focusout(function() {
		        $('#myContent').css("border","2px dashed orange");
		        $('#volver').css("display","inline");
		    }).focusin(function(){
		    	$('#myContent').css("border","2px dashed grey");
		    	$('#volver').css("display","none");
		    });

		    // Datos de ayuda.
			var dataArray = [];
			
			$.each(res.help, function (index, value) {
			    dataArray.push(value["text"].toString());
			});

			for (var i=0;i<dataArray.length;i++){
				var div = document.createElement('li');
				div.className = "comoJugar"
				div.innerHTML = dataArray[i];
				document.getElementById('lista').appendChild(div);
			}	

			var title = document.getElementById('gametitle');
			title.innerHTML = "Juego: " + res.titulo;			
		});
	</script>

	<body>
		<p class="comoJugar" id="titulo">Zona de Juego</p> 
		<p class="comoJugar" style="top:-50px;">
			C&oacutemo jugar.
			<ul id="lista" class="comoJugar" style= "position:fixed;"></ul>
		</p>
		<div id="container" style="position:fixed; top:0; left:0; width:100%; height:100%;">  
		  <div style="height:100%; display:table; margin:0 auto;">  
			<div style="vertical-align:middle; display:table-cell;">
				<p id="gametitle" class="comoJugar" style="position:inherited; margin-top:-15px;">Recuadro de Juego</p>
				<div id= "myContent" style=""></div>
				<p id="volver" class="comoJugar" style="position:fixed; margin-top:-8px; color: orange; display:none">Click para volver al juego.</p>
			</div>
		  </div>
		</div>
	</body>
</html>